"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("react");var V=Object.defineProperty,C=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,E=(e,t,n)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,l=(e,t)=>{for(var n in t||(t={}))J.call(t,n)&&E(e,n,t[n]);if(C)for(var n of C(t))K.call(t,n)&&E(e,n,t[n]);return e},i=(e,t,n)=>new Promise((a,u)=>{var p=r=>{try{o(n.next(r))}catch(m){u(m)}},y=r=>{try{o(n.throw(r))}catch(m){u(m)}},o=r=>r.done?a(r.value):Promise.resolve(r.value).then(p,y);o((n=n.apply(e,t)).next())}),W=class{constructor({appId:e,apiKey:t,customerApiToken:n,apiUrl:a="https://appapi.heymantle.com/v1"}){if(!e)throw new Error("MantleClient appId is required");if(typeof window<"u"&&t)throw new Error("MantleClient apiKey should never be used in the browser");this.appId=e,this.apiKey=t,this.customerApiToken=n,this.apiUrl=a}mantleRequest(e){return i(this,arguments,function*({path:t,method:n="GET",body:a}){try{const u=`${this.apiUrl}${t.startsWith("/")?"":"/"}${t}${a&&n==="GET"?`?${new URLSearchParams(a)}`:""}`;return yield(yield fetch(u,l({method:n,headers:l(l({"Content-Type":"application/json",Accept:"application/json","X-Mantle-App-Id":this.appId},this.apiKey?{"X-Mantle-App-Api-Key":this.apiKey}:{}),this.customerApiToken?{"X-Mantle-Customer-Api-Token":this.customerApiToken}:{})},a&&n!=="GET"&&{body:JSON.stringify(a)}))).json()}catch(u){throw console.error(`[mantleRequest] ${t} error: ${u.message}`),u}})}identify(e){return i(this,null,function*(){return yield this.mantleRequest({path:"identify",method:"POST",body:e})})}getCustomer(e){return i(this,null,function*(){return(yield this.mantleRequest(l({path:"customer"},e?{body:{id:e}}:{}))).customer})}subscribe(e){return i(this,null,function*(){return yield this.mantleRequest({path:"subscriptions",method:"POST",body:e})})}cancelSubscription(e){return i(this,null,function*(){return yield this.mantleRequest(l({path:"subscriptions",method:"DELETE"},(e==null?void 0:e.cancelReason)&&{body:{cancelReason:e.cancelReason}}))})}updateSubscription(e){return i(this,null,function*(){return yield this.mantleRequest({path:"subscriptions",method:"PUT",body:e})})}sendUsageEvent(e){return i(this,null,function*(){return yield this.mantleRequest({path:"usage_events",method:"POST",body:e})})}sendUsageEvents(e){return i(this,null,function*(){return yield this.mantleRequest({path:"usage_events",method:"POST",body:e})})}addPaymentMethod(e){return i(this,null,function*(){return yield this.mantleRequest(l({path:"payment_methods",method:"POST"},e.returnUrl&&{body:{returnUrl:e.returnUrl}}))})}getUsageMetricReport(e){return i(this,null,function*(){return yield this.mantleRequest({path:`usage_events/${e.id}/report`,body:l(l({},e.period?{period:e.period}:{}),e.customerId?{customerId:e.customerId}:{})})})}listInvoices(){return i(this,arguments,function*(e={}){var t,n;return yield this.mantleRequest({path:"invoices",body:{page:(t=e.page)!=null?t:0,limit:(n=e.limit)!=null?n:10}})})}createHostedSession(e){return i(this,null,function*(){const t=yield this.mantleRequest({path:"hosted_sessions",method:"POST",body:e});return l(l({},(t==null?void 0:t.session)||{}),(t==null?void 0:t.error)||{error:t.error})})}};const c={Annual:"ANNUAL",Every30Days:"EVERY_30_DAYS"},Q={Public:"public",CustomerTag:"customerTag",ShopifyPlan:"shopifyPlan",Customer:"customer",Hidden:"hidden"},f={AmountPerInterval:"{{ amount }} per {{ interval }}",Back:"Back",Cancel:"Cancel",CancelConfirmation:"Are you sure you want to cancel your subscription?",CancelPlan:"Cancel plan",ChangePlan:"Change plan",CurrentPlan:"Current plan",CustomPlans:"Custom plans",CustomPlansDescription:"Plans tailored to your specific needs",DiscountAmount:"{{ amount }} discount",DiscountAmountExpired:"{{ amount }} discount expired",FreeTrialLength:"{{ trialDays }}-day free trial",Features:"Features",Month:"month",MonthShort:"mo",Monthly:"Monthly",NextBillingDate:"Next billing date",NotSubscribed:"You're not subscribed to a plan yet.",Year:"year",YearShort:"yr",Yearly:"Yearly",MostPopular:"Most popular",Per:"/",Plans:"Plans",Price:"Price",SelectPlan:"Select plan",SubscribeSuccessTitle:"Subscription successful",SubscribeSuccessBody:"Thanks for subscribing to our app!",Subscription:"Subscription",SubscriptionCancelled:"Subscription cancelled",UsageCharges:"Usage charges"},M=h.createContext(),Z=({feature:e,count:t=0})=>(e==null?void 0:e.type)==="boolean"?e.value:(e==null?void 0:e.type)==="limit"?t<e.value||e.value===-1:!1,z=({appId:e,customerApiToken:t,apiUrl:n="https://appapi.heymantle.com/v1",children:a,i18n:u=f,waitForCustomer:p=!1,loadingComponent:y=null})=>{const o=new W({appId:e,customerApiToken:t,apiUrl:n}),[r,m]=h.useState(null),[P,g]=h.useState(!0),S=async()=>{try{g(!0);const s=await o.getCustomer();m(s)}catch(s){console.error("[MantleProvider] Error fetching customer: ",s)}finally{g(!1)}},U=async s=>{await o.sendUsageEvent(s)},A=async({usageId:s,period:d})=>await o.getUsageMetricReport({id:s,period:d}),T=async({planId:s,planIds:d,discountId:w,billingProvider:b,returnUrl:I,useSavedPaymentMethod:F=!1,trialDays:$,hosted:N=!0,collectionMethod:Y="charge_automatically",daysUntilDue:j,paymentMethodTypes:B=["card"],automaticTax:H=!0,requireBillingAddress:k=!1,email:G,metadata:X})=>await o.subscribe({planId:s,planIds:d,discountId:w,billingProvider:b,returnUrl:I,useSavedPaymentMethod:F,trialDays:$,hosted:N,collectionMethod:Y,daysUntilDue:j,paymentMethodTypes:B,automaticTax:H,requireBillingAddress:k,email:G,metadata:X}),L=async({cancelReason:s}={})=>await o.cancelSubscription({...s&&{cancelReason:s}}),x=async({returnUrl:s})=>await o.addPaymentMethod({returnUrl:s}),D=async({type:s,config:d})=>{const b=new URL(document.location.toString()).searchParams.get("locale");return await o.createHostedSession({type:s,config:{...b?{locale:b}:{},...d||{}}})};h.useEffect(()=>{t&&S()},[t]);const O=(r==null?void 0:r.plans)||[],q=r==null?void 0:r.subscription;return p&&P?y||"":h.createElement(M.Provider,{value:{client:o,customer:r,subscription:q,plans:O,loading:P,i18n:{...f,...u},sendUsageEvent:U,getUsageReport:A,subscribe:T,cancelSubscription:L,addPaymentMethod:x,createHostedSession:D,isFeatureEnabled:({featureKey:s,count:d=0})=>r!=null&&r.features[s]?Z({feature:r.features[s],count:d}):!1,limitForFeature:({featureKey:s})=>r!=null&&r.features[s]&&r.features[s].type==="limit"?r.features[s].value:-1,refetch:async()=>{await S()}}},a)},ee=()=>{const e=h.useContext(M);if(e===void 0)throw new Error("useMantle must be used within a MantleProvider");return e},v=e=>e.type==="boolean"&&e.value==!0||e.type==="limit"&&e.value!==0,te=(e,t)=>v(t)-v(e)||e.name.localeCompare(t.name),ne=(e="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:e,notation:"standard"}),re=(e,t="USD",n=!0)=>{let a=ne(t).format(e);return n&&(a=a.replace(/\.00$/,"")),a},_=(e=c.Every30Days)=>{switch(e){case c.Annual:return"year";case c.Every30Days:default:return"month"}},R=(e=c.Every30Days)=>{switch(e){case c.Annual:return"yr";case c.Every30Days:default:return"mo"}},se=({interval:e=c.Every30Days,useShortFormPlanIntervals:t=!0})=>t?R(e):_(e),ae=({plan:e,customFieldKey:t="recommended"})=>{var n;return!!((n=e.customFields)!=null&&n[t])},oe=({plan:e,customFieldKey:t="buttonLabel"})=>{var n;return((n=e.customFields)==null?void 0:n[t])||f.SelectPlan},ie=({plan:e})=>{var t;return((t=e.discounts)==null?void 0:t.length)>0?e.discounts.reduce((n,a)=>n.discountedAmount<a.discountedAmount?n:a):void 0},le=(e=4)=>e%4===0?{xs:6,sm:6,md:2,lg:3,xl:3}:e%3===0?{xs:6,sm:6,md:2,lg:4,xl:4}:e%2===0?{xs:6,sm:6,md:3,lg:6,xl:6}:e===1?{xs:6,sm:6,md:6,lg:12,xl:12}:{xs:6,sm:6,md:2,lg:4,xl:4},ue=(e=4)=>e%4===0?4:e%3===0?3:e%2===0?2:e===1?1:4;exports.Labels=f;exports.MantleProvider=z;exports.PlanAvailability=Q;exports.PlanInterval=c;exports.columnCount=ue;exports.columnSpan=le;exports.customButtonLabel=oe;exports.featureEnabled=v;exports.featureSort=te;exports.highestDiscount=ie;exports.intervalLabel=se;exports.intervalLabelLong=_;exports.intervalLabelShort=R;exports.isRecommendedPlan=ae;exports.money=re;exports.useMantle=ee;
