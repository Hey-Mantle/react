"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("react");class j{constructor({appId:t,apiKey:n,customerApiToken:a,apiUrl:s="https://appapi.heymantle.com/v1"}){if(!t)throw new Error("MantleClient appId is required");if(typeof window<"u"&&n)throw new Error("MantleClient apiKey should never be used in the browser");this.appId=t,this.apiKey=n,this.customerApiToken=a,this.apiUrl=s}async mantleRequest({path:t,method:n="GET",body:a}){try{const s=`${this.apiUrl}${t.startsWith("/")?"":"/"}${t}${a&&n==="GET"?`?${new URLSearchParams(a)}`:""}`;return await(await fetch(s,{method:n,headers:{"Content-Type":"application/json",Accept:"application/json","X-Mantle-App-Id":this.appId,...this.apiKey?{"X-Mantle-App-Api-Key":this.apiKey}:{},...this.customerApiToken?{"X-Mantle-Customer-Api-Token":this.customerApiToken}:{}},...a&&n!=="GET"&&{body:JSON.stringify(a)}})).json()}catch(s){throw console.error(`[mantleRequest] ${t} error: ${s.message}`),s}}async identify({platform:t="shopify",platformId:n,myshopifyDomain:a,accessToken:s,name:l,email:d,platformPlanName:i,customFields:o,features:b,createdAt:m,rotateApiToken:p,tags:y,operators:g,address:f,contacts:S,defaultBillingProvider:w,stripeId:C}){return await this.mantleRequest({path:"identify",method:"POST",body:{platformId:n,myshopifyDomain:a,platform:t,accessToken:s,name:l,email:d,platformPlanName:i,customFields:o,features:b,createdAt:m,rotateApiToken:p,tags:y,operators:g,address:f,contacts:S,defaultBillingProvider:w,stripeId:C}})}async getCustomer(t){return(await this.mantleRequest({path:"customer",...t?{body:{id:t}}:{}})).customer}async subscribe({planId:t,planIds:n,discountId:a,returnUrl:s,billingProvider:l,trialDays:d,hosted:i=!0,useSavedPaymentMethod:o=!1,collectionMethod:b="charge_automatically",daysUntilDue:m,paymentMethodTypes:p=["card"],automaticTax:y=!0,requireBillingAddress:g=!1,email:f,metadata:S}){return await this.mantleRequest({path:"subscriptions",method:"POST",body:{planId:t,planIds:n,discountId:a,returnUrl:s,billingProvider:l,trialDays:d,hosted:i,useSavedPaymentMethod:o,requireBillingAddress:g,email:f,metadata:S,collectionMethod:b,daysUntilDue:m,paymentMethodTypes:p,automaticTax:y}})}async cancelSubscription({cancelReason:t}={}){return await this.mantleRequest({path:"subscriptions",method:"DELETE",...t&&{body:{cancelReason:t}}})}async updateSubscription({id:t,cappedAmount:n}){return await this.mantleRequest({path:"subscriptions",method:"PUT",body:{id:t,cappedAmount:n}})}async sendUsageEvent({eventId:t,eventName:n,timestamp:a,customerId:s,properties:l={}}){return await this.mantleRequest({path:"usage_events",method:"POST",body:{eventId:t,eventName:n,timestamp:a,...s?{customerId:s}:{},properties:l}})}async sendUsageEvents({events:t}){return await this.mantleRequest({path:"usage_events",method:"POST",body:{events:t}})}async addPaymentMethod({returnUrl:t}){return await this.mantleRequest({path:"payment_methods",method:"POST",...t&&{body:{returnUrl:t}}})}async getUsageMetricReport({id:t,period:n,customerId:a}){return await this.mantleRequest({path:`usage_events/${t}/report`,body:{...n?{period:n}:{},...a?{customerId:a}:{}}})}async listInvoices({page:t=0,limit:n=10}={}){return await this.mantleRequest({path:"invoices",body:{page:t,limit:n}})}async createHostedSession(t){const{type:n,config:a}=t,s=await this.mantleRequest({path:"hosted_sessions",method:"POST",body:{type:n,config:a}});return{...(s==null?void 0:s.session)||{},...(s==null?void 0:s.error)||{error:s.error}}}}const H={finalize:"finalize",setup:"setup",subscribe:"subscribe"};var G={MantleClient:j,SubscriptionConfirmType:H};const c={Annual:"ANNUAL",Every30Days:"EVERY_30_DAYS"},X={Public:"public",CustomerTag:"customerTag",ShopifyPlan:"shopifyPlan",Customer:"customer",Hidden:"hidden"},P={AmountPerInterval:"{{ amount }} per {{ interval }}",Back:"Back",Cancel:"Cancel",CancelConfirmation:"Are you sure you want to cancel your subscription?",CancelPlan:"Cancel plan",ChangePlan:"Change plan",CurrentPlan:"Current plan",CustomPlans:"Custom plans",CustomPlansDescription:"Plans tailored to your specific needs",DiscountAmount:"{{ amount }} discount",DiscountAmountExpired:"{{ amount }} discount expired",FreeTrialLength:"{{ trialDays }}-day free trial",Features:"Features",Month:"month",MonthShort:"mo",Monthly:"Monthly",NextBillingDate:"Next billing date",NotSubscribed:"You're not subscribed to a plan yet.",Year:"year",YearShort:"yr",Yearly:"Yearly",MostPopular:"Most popular",Per:"/",Plans:"Plans",Price:"Price",SelectPlan:"Select plan",SubscribeSuccessTitle:"Subscription successful",SubscribeSuccessBody:"Thanks for subscribing to our app!",Subscription:"Subscription",SubscriptionCancelled:"Subscription cancelled",UsageCharges:"Usage charges"},T=h.createContext(),J=({feature:e,count:t=0})=>(e==null?void 0:e.type)==="boolean"?e.value:(e==null?void 0:e.type)==="limit"?t<e.value||e.value===-1:!1,K=({appId:e,customerApiToken:t,apiUrl:n="https://appapi.heymantle.com/v1",children:a,i18n:s=P,waitForCustomer:l=!1,loadingComponent:d=null})=>{const i=new G.MantleClient({appId:e,customerApiToken:t,apiUrl:n}),[o,b]=h.useState(null),[m,p]=h.useState(!0),y=async()=>{try{p(!0);const r=await i.getCustomer();b(r)}catch(r){console.error("[MantleProvider] Error fetching customer: ",r)}finally{p(!1)}},g=async r=>{await i.sendUsageEvent(r)},f=async({usageId:r,period:u})=>await i.getUsageMetricReport({id:r,period:u}),S=async({planId:r,planIds:u,discountId:M,billingProvider:v,returnUrl:U,useSavedPaymentMethod:q=!1,trialDays:F,hosted:_=!0,collectionMethod:$="charge_automatically",daysUntilDue:O,paymentMethodTypes:N=["card"],automaticTax:Y=!0,requireBillingAddress:B=!1,email:I,metadata:k})=>await i.subscribe({planId:r,planIds:u,discountId:M,billingProvider:v,returnUrl:U,useSavedPaymentMethod:q,trialDays:F,hosted:_,collectionMethod:$,daysUntilDue:O,paymentMethodTypes:N,automaticTax:Y,requireBillingAddress:B,email:I,metadata:k}),w=async({cancelReason:r}={})=>await i.cancelSubscription({...r&&{cancelReason:r}}),C=async({returnUrl:r})=>await i.addPaymentMethod({returnUrl:r}),L=async({type:r,config:u})=>{const v=new URL(document.location.toString()).searchParams.get("locale");return await i.createHostedSession({type:r,config:{...v?{locale:v}:{},...u||{}}})};h.useEffect(()=>{t&&y()},[t]);const x=(o==null?void 0:o.plans)||[],D=o==null?void 0:o.subscription;return l&&m?d||"":h.createElement(T.Provider,{value:{client:i,customer:o,subscription:D,plans:x,loading:m,i18n:{...P,...s},sendUsageEvent:g,getUsageReport:f,subscribe:S,cancelSubscription:w,addPaymentMethod:C,createHostedSession:L,isFeatureEnabled:({featureKey:r,count:u=0})=>o!=null&&o.features[r]?J({feature:o.features[r],count:u}):!1,limitForFeature:({featureKey:r})=>o!=null&&o.features[r]&&o.features[r].type==="limit"?o.features[r].value:-1,refetch:async()=>{await y()}}},a)},V=()=>{const e=h.useContext(T);if(e===void 0)throw new Error("useMantle must be used within a MantleProvider");return e},E=e=>e.type==="boolean"&&e.value==!0||e.type==="limit"&&e.value!==0,W=(e,t)=>E(t)-E(e)||e.name.localeCompare(t.name),Q=(e="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:e,notation:"standard"}),Z=(e,t="USD",n=!0)=>{let a=Q(t).format(e);return n&&(a=a.replace(/\.00$/,"")),a},A=(e=c.Every30Days)=>{switch(e){case c.Annual:return"year";case c.Every30Days:default:return"month"}},R=(e=c.Every30Days)=>{switch(e){case c.Annual:return"yr";case c.Every30Days:default:return"mo"}},z=({interval:e=c.Every30Days,useShortFormPlanIntervals:t=!0})=>t?R(e):A(e),ee=({plan:e,customFieldKey:t="recommended"})=>{var n;return!!((n=e.customFields)!=null&&n[t])},te=({plan:e,customFieldKey:t="buttonLabel"})=>{var n;return((n=e.customFields)==null?void 0:n[t])||P.SelectPlan},ne=({plan:e})=>{var t;return((t=e.discounts)==null?void 0:t.length)>0?e.discounts.reduce((n,a)=>n.discountedAmount<a.discountedAmount?n:a):void 0},ae=(e=4)=>e%4===0?{xs:6,sm:6,md:2,lg:3,xl:3}:e%3===0?{xs:6,sm:6,md:2,lg:4,xl:4}:e%2===0?{xs:6,sm:6,md:3,lg:6,xl:6}:e===1?{xs:6,sm:6,md:6,lg:12,xl:12}:{xs:6,sm:6,md:2,lg:4,xl:4},se=(e=4)=>e%4===0?4:e%3===0?3:e%2===0?2:e===1?1:4;exports.Labels=P;exports.MantleProvider=K;exports.PlanAvailability=X;exports.PlanInterval=c;exports.columnCount=se;exports.columnSpan=ae;exports.customButtonLabel=te;exports.featureEnabled=E;exports.featureSort=W;exports.highestDiscount=ne;exports.intervalLabel=z;exports.intervalLabelLong=A;exports.intervalLabelShort=R;exports.isRecommendedPlan=ee;exports.money=Z;exports.useMantle=V;
